%---------------------------------------------
% Author: Clecio Jung
% Date: 20/02/2021
%---------------------------------------------

clc;
close all;

%---------------------------------------------
% Parameters
%---------------------------------------------

% Gravitational constant
G = 6.67408*10^(-11); % m^3/(kg*s2^)

% simulation parameters
dt = 10000;
tf = 1e10;
extrap = 1000;
n = ceil(tf/(extrap*dt));

% Sun
c = [];
c(1).name = 'Sun';
c(1).c = 'y';
c(1).sz = 10;
c(1).m = 1.9885*10^30; % kg
c(1).r(1,:) = [0 0 0];
c(1).v(1,:) = [0 0 0];

% Mercury
c(2).name = 'Mercury';
c(2).c = 'k';
c(2).sz = 3;
c(2).m = 3.302*10^23; % kg
c(2).r(1,:) = [1.563021412664830e10 4.327888220902108e10 2.102123103174893e9];
c(2).v(1,:) = [-5.557001175482630e4 1.840863017229157e4 6.602621285552567e3];

% Venus
c(3).name = 'Venus';
c(3).c = 'm';
c(3).sz = 3;
c(3).m = 4.8685*10^24; % kg
c(3).r(1,:) = [-9.030189258080004e10 5.802615456116644e10 6.006513603716755e9];
c(3).v(1,:) = [-1.907374632532257e4 -2.963461693326599e4 6.946391255404438e2];

% Earth
c(4).name = 'Earth';
c(4).c = 'b';
c(4).sz = 4;
c(4).m = 5.97219*10^24; % kg
c(4).r(1,:) = [-1.018974476358996e11 1.065689158175689e11 -3.381951053601424e6];
c(4).v(1,:) = [-2.201749257051057e4 -2.071074857788741e4 1.575245213712245];

% Mars
c(5).name = 'Mars';
c(5).c = 'r';
c(5).sz = 4;
c(5).m = 6.4171*10^23; % kg
c(5).r(1,:) = [-2.443763125844157e11 4.473211564076996e10 6.935657388967808e9];
c(5).v(1,:) = [-3.456935754608896e3 -2.176307370133160e4 -3.711433859326417e2];

% Jupiter
c(6).name = 'Jupiter';
c(6).c = 'c';
c(6).sz = 7;
c(6).m = 1.89813*10^27; % kg
c(6).r(1,:) = [-2.35165468275322006e11 7.421837640432589e11 2.179850895804323e9];
c(6).v(1,:) = [-1.262559929908801e4 -3.332552395475581e3 2.962741332356101e2];

% Saturn
c(7).name = 'Saturn';
c(7).c = 'r';
c(7).sz = 5;
c(7).m = 5.6834*10^26; % kg
c(7).r(1,:) = [-1.011712827283427e12 -1.077496255617324e12 5.901251900068215e10];
c(7).v(1,:) = [6.507898648442419e3 -6.640809674126991e3 -1.434198106014633e2];

% Uranus
c(8).name = 'Uranus';
c(8).c = 'g';
c(8).sz = 5;
c(8).m = 8.6813*10^25; % kg
c(8).r(1,:) = [2.934840841770302e12 6.048399137411513e11 -3.576451387567792e10];
c(8).v(1,:) = [-1.433852081777671e3 6.347897341634990e3 4.228261484335974e1];

% Neptune
c(9).name = 'Neptune';
c(9).c = 'b';
c(9).sz = 5;
c(9).m = 1.02413*10^26; % kg
c(9).r(1,:) = [4.055112581124043e12 -1.914578873112663e12 -5.400973716179796e10];
c(9).v(1,:) = [2.275119229131818e3 4.942356914027413e3 -1.548950389954096e1];

% Pluto
c(10).name = 'Pluto';
c(10).c = 'k';
c(10).sz = 2;
c(10).m = 1.307*10^22; % kg
c(10).r(1,:) = [9.514009594170194e11 -4.776029500570151e12 2.358627841705075e11];
c(10).v(1,:) = [5.431808363374300e3 -2.387056445508962e1 -1.551877289694926e3];

%---------------------------------------------
% Simulation
%---------------------------------------------

N = length(c);
for i = 2:n
    for j = 1:N
        c(j).vaux = c(j).v(i-1,:);
        c(j).raux = c(j).r(i-1,:);
    end
    for l = 1:extrap
        for j = 1:N
            F = 0;
            for k = 1:N
                if k ~= j
                    rjk = c(j).raux - c(k).raux;
                    r = norm(rjk);
                    F = F - G*c(j).m*c(k).m/r^3*rjk;
                end
            end
            
            % Euler method
            c(j).vaux = c(j).vaux + (F/c(j).m)*dt;
            c(j).raux = c(j).raux + c(j).vaux*dt;
        end
    end
    for j = 1:N
        c(j).v(i,:) = c(j).vaux;
        c(j).r(i,:) = c(j).raux;
    end
end

%---------------------------------------------
% Charts
%---------------------------------------------

fig = figure('WindowState','maximized');
for i = 1:n
    clf;
    for j = 1:N
        plot3(c(j).r(1:i,1),c(j).r(1:i,2),c(j).r(1:i,3),strcat('-',c(j).c));
        hold on;
        grid on;
        plot3(c(j).r(i,1),c(j).r(i,2),c(j).r(i,3),'ok','MarkerSize',c(j).sz,'MarkerFaceColor',c(j).c);
    end
    pause(0.1);
end

%---------------------------------------------